<h2 class="mb-3">Location Details</h2>
<div class="fleet-content-wrapper overflow-auto">
  <div class="me-md-2">
    <!-- AREA DETAIL START -->
    <div class="fleet-wrapper mb-4">
        <div class="py-3 px-4 border-bottom">
          <h3 class="mb-0 fs-5">30 Clingstone Pl area</h3>
        </div>
        <div class="py-3 px-3 py-md-4 px-md-4">
          <div class="row p-0">
            <div class="col-12 col-lg-5 col-xl-4">
              <div class="d-flex justify-content-between flex-column flex-sm-row flex-lg-column mb-4">
                <div class="d-flex align-items-start gap-3 mb-lg-5">
                  <div
                    class="location-icon rounded-circle d-flex align-items-center justify-content-center flex-shrink-0">
                    <span class="d-flex align-items-center justify-content-center">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                        fill="currentColor">
                        <path
                          d="M12 20.8995L16.9497 15.9497C19.6834 13.2161 19.6834 8.78392 16.9497 6.05025C14.2161 3.31658 9.78392 3.31658 7.05025 6.05025C4.31658 8.78392 4.31658 13.2161 7.05025 15.9497L12 20.8995ZM12 23.7279L5.63604 17.364C2.12132 13.8492 2.12132 8.15076 5.63604 4.63604C9.15076 1.12132 14.8492 1.12132 18.364 4.63604C21.8787 8.15076 21.8787 13.8492 18.364 17.364L12 23.7279ZM12 13C13.1046 13 14 12.1046 14 11C14 9.89543 13.1046 9 12 9C10.8954 9 10 9.89543 10 11C10 12.1046 10.8954 13 12 13ZM12 15C9.79086 15 8 13.2091 8 11C8 8.79086 9.79086 7 12 7C14.2091 7 16 8.79086 16 11C16 13.2091 14.2091 15 12 15Z">
                        </path>
                      </svg>
                    </span>
                  </div>
                  <div class="location-detail mb-3 mb-sm-0">
                    <h5 class="text-capitalize fw-medium">{{organizationData.name}}</h5>
                    <a href="javascript:void(0)" class="text-decoration-none d-block fw-medium">
                      {{selectedLocation.address.streetAddress}}, {{selectedLocation.address.city}}
                      {{selectedLocation.address.state}}
                      {{selectedLocation.address.postalCode}} {{selectedLocation.address.country}} Phone:
                      {{selectedLocation.address.phoneNumber}}
                    </a>
                  </div>
                </div>

                <div class="d-flex align-items-start gap-3">
                  <div
                    class="location-icon rounded-circle d-flex align-items-center justify-content-center flex-shrink-0">
                    <span class="d-flex align-items-center justify-content-center">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                        fill="currentColor">
                        <path
                          d="M10.0014 14.6757C10.0011 14.6551 10.001 14.6345 10.001 14.6138C10.001 12.1055 12.0175 9.99564 14.7539 9.38092C14.3904 7.07873 11.9602 5.19995 8.90098 5.19995C5.58037 5.19995 3.00098 7.41344 3.00098 9.9793C3.00098 10.9487 3.36131 11.88 4.04082 12.6781C4.0728 12.7157 4.12443 12.7717 4.19342 12.8427C4.78537 13.4517 5.13709 14.2457 5.19546 15.0805C5.90857 14.6683 6.74285 14.5123 7.55832 14.6392C7.72416 14.665 7.85986 14.6847 7.96345 14.6982C8.27111 14.7383 8.58419 14.7586 8.90098 14.7586C9.27825 14.7586 9.64595 14.7301 10.0014 14.6757ZM10.4581 16.627C9.95467 16.7133 9.43399 16.7586 8.90098 16.7586C8.49441 16.7586 8.09502 16.7323 7.70499 16.6815C7.58312 16.6656 7.4317 16.6436 7.25073 16.6154C6.87693 16.5572 6.49436 16.6321 6.1713 16.8268L4.26653 17.9745C4.12052 18.0646 3.94891 18.1057 3.77733 18.0916C3.33814 18.0554 3.01178 17.6744 3.04837 17.2405L3.19859 15.4596C3.23664 15.0086 3.07664 14.5632 2.75931 14.2367C2.66182 14.1364 2.5814 14.0491 2.51802 13.9747C1.56406 12.8542 1.00098 11.4732 1.00098 9.9793C1.00098 6.23517 4.53793 3.19995 8.90098 3.19995C12.9601 3.19995 16.3041 5.82699 16.7504 9.20788C20.1225 9.36136 22.801 11.723 22.801 14.6138C22.801 15.8068 22.3448 16.9097 21.572 17.8044C21.5206 17.8639 21.4555 17.9336 21.3765 18.0137C21.1194 18.2744 20.9898 18.6301 21.0206 18.9903L21.1423 20.4125C21.172 20.759 20.9076 21.0632 20.5518 21.0921C20.4128 21.1034 20.2738 21.0706 20.1555 20.9986L18.6124 20.0821C18.3506 19.9266 18.0407 19.8668 17.7379 19.9133C17.5913 19.9358 17.4686 19.9533 17.3699 19.966C17.0539 20.0066 16.7303 20.0277 16.401 20.0277C13.7074 20.0277 11.4025 18.6201 10.4581 16.627ZM17.4346 17.9364C18.0019 17.8494 18.5793 17.911 19.1105 18.1111C19.2492 17.5503 19.5373 17.0304 19.9524 16.6094C20.0027 16.5585 20.0388 16.5198 20.0584 16.4971C20.5467 15.9318 20.801 15.2839 20.801 14.6138C20.801 12.8095 18.8983 11.2 16.401 11.2C13.9037 11.2 12.001 12.8095 12.001 14.6138C12.001 16.4181 13.9037 18.0277 16.401 18.0277C16.6424 18.0277 16.8809 18.0124 17.115 17.9823C17.1957 17.972 17.3029 17.9566 17.4346 17.9364Z">
                        </path>
                      </svg>
                    </span>
                  </div>
                  <div class="location-detail mb-3 mb-sm-0">
                    <h5 class="text-capitalize fw-medium">Business hours</h5>
                    <p class="mb-0 fw-medium">Mon-Fri from {{selectedLocation.workingHours.startTime}} to
                      {{selectedLocation.workingHours.endTime}}</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-7 col-xl-8">
              <div>
                <div class="location-map">
                  <google-map [options]="mapOptions" [width]="'100%'" [height]="450">
                    <map-marker [position]="marker.position"></map-marker>
                  </google-map>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
    <!-- AREA DETAIL EBD -->


    <!-- TAXES AND FEES START -->
    <div class="fleet-wrapper">
      <div class="py-3 px-3 px-md-4 d-flex align-items-center justify-content-between">
        <h3 class="mb-0 fs-4">Taxes and Surcharges</h3>
        <button class="btn btn-secondary px-2 flex-shrink-0" data-bs-target="#addLocationModal" data-bs-toggle="modal"
          (click)="onAddEntity()">Add Entity</button>
      </div>
      @for (data of taxAndFeesData; track data; let j = $index) {
      <div class="">
        <div>
          <!-- ACCORDION START -->
          <div class="accordion" [id]="data.entity">
            <div class="accordion-item border-0">
              <div class="d-flex align-items-center gap-1 justify-content-between">
                <h2 class="d-inline-block px-3 px-md-4 mb-0" id="heading1">
                  <button class="accordion-button px-0 my-1 fw-medium" type="button" data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#' + trimEntityString(data.entity) + trimEntityString(data.entity)"
                    aria-expanded="true" aria-controls="collapse1">
                    {{data.entity}}
                  </button>
                </h2>
                <div class="d-flex align-items-center gap-1 justify-content-center px-3 px-md-4">
                  <div class="d-flex align-items-center gap-1 justify-content-center">
                    <button class="btn btn-transparent float-end p-1 px-md-2" data-bs-target="#addLocationModal"
                      data-bs-toggle="modal" (click)="onEdit(data)">
                      <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="edit-item"
                        viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="currentColor"
                          stroke="none">
                          <path
                            d="M3720 4629 c-145 -22 -268 -78 -393 -179 -40 -32 -637 -624 -1329
                                                          -1316 l-1256 -1259 -15 -70 c-210 -975 -249 -1167 -243 -1200 9 -46 57 -101
                                                          103 -116 19 -6 54 -9 77 -6 30 4 983 207 1186 252 27 7 2526 2496 2609 2600
                                                          279 349 224 860 -121 1131 -169 132 -408 195 -618 163z m223 -324 c243 -51
                                                          410 -294 369 -537 -23 -139 -59 -193 -275 -413 l-192 -196 -340 341 -340 340
                                                          201 200 c174 174 209 204 266 229 110 50 197 60 311 36z m-688 -1736 c-198
                                                          -198 -628 -625 -955 -949 l-596 -588 -423 -91 c-233 -50 -425 -90 -427 -88 -1
                                                          1 38 194 88 427 l90 425 951 953 952 952 340 -340 340 -340 -360 -361z" />
                        </g>
                      </svg>
                    </button>
                    <button class="btn btn-transparent float-end p-1 px-md-2" data-bs-toggle="modal"
                      data-bs-target="#deleteModal" (click)="onDelete(data)">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                        fill="currentColor" class="delete-item">
                        <path
                          d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 11H11V17H9V11ZM13 11H15V17H13V11ZM9 4V6H15V4H9Z">
                        </path>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
              <div class="accordion-collapse collapse show"
                [id]="trimEntityString(data.entity) + trimEntityString(data.entity)" aria-labelledby="heading1"
                [attr.data-bs-parent]="'#' + trimEntityString(data.entity)">
                <div class="accordion-body py-0 px-0">
                  <!-- TABLE START -->
                  <app-listing [tableData]="data.taxAndFees" [headers]="headers" [entity]="j" [entityName]="data.entity"
                    (editClicked)="onEditClicked($event)"></app-listing>
                  <div class="d-block">
                    <button type="button"
                      class="btn btn-outline-secondary bg-white d-block ms-auto my-3 me-3 me-md-4 btn-outline rounded-3 fw-medium"
                      (click)="addRow(j, data.entity)"> Add Row </button>
                  </div>
                  <!-- TABLE END -->
                </div>
              </div>
            </div>
          </div>
          <!-- ACCORDION END -->
        </div>
      </div>
      }
    </div>
    <!-- TAXES AND FEES END -->
  </div>
</div>


<!-- ADD ENTITY MODAL START -->
<div class="modal fade" id="addLocationModal" aria-labelledby="addLocationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content bg-white">
      <div class="modal-header">
        <h2 class="modal-title fs-5" id="exampleModalLabel">Add Tax Entity</h2>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <div class="fleet-content-wrapper">
          <div class="fleet-wrapper">
            <div class="py-3 px-3 px-sm-4">
              <form [formGroup]="addEntityForm" (ngSubmit)="addEntity()">
                <div class="row mb-2">
                  <div class="col-12 col-sm-6">
                    <label>Entity Name</label>
                    <input type="text" class="form-control" formControlName="entity">
                  </div>
                  <div class="col-12 col-sm-6">
                    <label>Street Address</label>
                    <input type="text" class="form-control" formControlName="streetAddress">
                  </div>
                </div>
                <div class="row mb-2">
                  <div class="col-12 col-sm-6">
                    <label>Country</label>
                    <select class="form-select" aria-label="Country" formControlName="country">
                      <option disabled>Select Country</option>
                      <option value="United States">United States</option>
                    </select>
                  </div>
                  <div class="col-12 col-sm-6">
                    <label>State</label>
                    <select class="form-select" aria-label="State" formControlName="state">
                      <option disabled>Select State</option>
                      <option value="TX">Texas</option>
                      <option value="California">California</option>
                      <option value="Alaska">Alaska</option>
                      <option value="Ohio">Ohio</option>
                      <option value="Georgia">Georgia</option>
                      <option value="New York">New York</option>
                    </select>
                  </div>

                </div>
                <div class="row mb-3">
                  <div class="col-12 col-sm-6">
                    <label>City</label>
                    <select class="form-select" aria-label="City" formControlName="city">
                      <option disabled>Select City</option>
                      <option value="The Woodlands">The Woodlands</option>
                      <option value="San Francisco">San Francisco</option>
                      <option value="New York City">New York City</option>
                      <option value="Chicago">Chicago</option>
                      <option value="Los Angeles">Los Angeles</option>
                      <option value="Seattle">Seattle</option>
                      <option value="Boston">Boston</option>
                      <option value="Houston">Houston</option>
                      <option value="San Diego">San Diego</option>

                    </select>
                  </div>
                  <div class="col-12 col-sm-6">
                    <label>Postal code</label>
                    <input type="text" class="form-control" formControlName="postalCode">
                  </div>
                  <div class="col-12 col-sm-6">
                    <label>Phone</label>
                    <input type="tel" class="form-control" formControlName="phone">
                  </div>
                </div>
                <div class="mb-2 d-flex align-items-center justify-content-between">
                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal"
                    [disabled]="addEntityForm.invalid">Save</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ADD ENTITY MODAL END -->


<div class="modal fade overflow-hidden" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-sm rounded-3">
    <div class="modal-content bg-white">
      <div class="modal-body">
        <p class="mb-4 fw-medium text-center">Are you sure to delete ?</p>
        <div class="d-flex align-items-center justify-content-center gap-3">
          <button type="button" class="btn btn-sm btn-outline-secondary rounded-2"
            data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-sm btn-outline-danger rounded-2" data-bs-dismiss="modal"
            (click)="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #nameTemplate let-inputValue="inputValue" let-index="index" let-entity="entity"
  let-entityName="entityName">
  <span>
    <input type="text" [id]="'input'+index+entityName"
      class="form-control border rounded-2 px-md-3 py-2 rounded-3 w-100 fw-medium" [class.disabled]="inputValue"
      [(ngModel)]="taxAndFeesData[entity].taxAndFees[index].name" (ngModelChange)="onChange($event, index)">
  </span>
</ng-template>

<ng-template #amountTemplate let-inputValue="inputValue" let-index="index" let-entity="entity"
  let-entityName="entityName">
  <span>
    <input type="text" [id]="'input2'+index+entityName"
      class="form-control border rounded-2 px-md-3 py-2 rounded-3 w-100 fw-medium" [class.disabled]="inputValue"
      [(ngModel)]="taxAndFeesData[entity].taxAndFees[index].amount" (ngModelChange)="onChange($event, index)">
  </span>
</ng-template>

<ng-template #appliedTemplate let-inputValue="inputValue" let-index="index" let-entity="entity"
  let-entityName="entityName">
  <div>
    <select [id]="'select'+index+entityName"
      class="form-select form-control border rounded-2 px-md-3 py-2 rounded-3 w-100 fw-medium"
      [class.disabled]="inputValue" [(ngModel)]="taxAndFeesData[entity].taxAndFees[index].applied">
      <option value="%">%</option>
      <option value="Flat">Flat</option>
    </select>
  </div>
</ng-template>

<ng-template #applied2Template let-inputValue="inputValue" let-index="index" let-entity="entity"
  let-entityName="entityName">
  <div>
    <select [id]="'select2'+index+entityName"
      class="form-select form-control border rounded-2 px-md-3 py-2 rounded-3 w-100 fw-medium"
      [class.disabled]="inputValue" [(ngModel)]="taxAndFeesData[entity].taxAndFees[index].applied2">
      <option value="Per Reservation">Per Reservation</option>
      <option value="Per Invoice">Per Invoice</option>
    </select>
  </div>
</ng-template>

<!-- <app-delete-confirm-modal></app-delete-confirm-modal> -->
